<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Modern Kilit Sim√ºlasyonu</title>
<style>
  :root {
    --pin-w: 45px;
    --pin-h: 180px;
    --shear-y: 108px;
    --main-bg: #1a1a2e;
    --lock-bg: #c49355;
    --pin-color: #3f3f5f;
    --pin-border: #2a2a2a;
    --key-pin: #ff4040;
    --driver-pin: #2176ff;
    --spring-color: #666;
    --success-color: #00ff9d;
    --error-color: #ff4757;
  }
  /* ... (stil kodlarƒ± aynƒ± ≈üekilde devam ediyor, kƒ±saltƒ±ldƒ±) ... */
  /* Kodun ba≈üƒ±ndaki stil kƒ±smƒ± deƒüi≈ümedi, olduƒüu gibi bƒ±rakabilirsin */
</style>
</head>
<body>
  <div class="background"></div>
  <div class="game-container">
    <div class="indicators">
      <div class="dot" id="dot0"></div>
      <div class="dot" id="dot1"></div>
      <div class="dot" id="dot2"></div>
      <div class="dot" id="dot3"></div>
      <div class="dot" id="dot4"></div>
    </div>
    <div class="lock" id="lock">
      <div class="pin" id="pin0">
        <div class="spring"></div>
        <div class="alt" id="a0"></div>
        <div class="drv" id="d0"></div>
      </div>
      <div class="pin" id="pin1">
        <div class="spring"></div>
        <div class="alt" id="a1"></div>
        <div class="drv" id="d1"></div>
      </div>
      <div class="pin" id="pin2">
        <div class="spring"></div>
        <div class="alt" id="a2"></div>
        <div class="drv" id="d2"></div>
      </div>
      <div class="pin" id="pin3">
        <div class="spring"></div>
        <div class="alt" id="a3"></div>
        <div class="drv" id="d3"></div>
      </div>
      <div class="pin" id="pin4">
        <div class="spring"></div>
        <div class="alt" id="a4"></div>
        <div class="drv" id="d4"></div>
      </div>
      <div class="lock-body">
        <div class="keyhole"></div>
      </div>
      <div class="lock-tools">
        <div class="tension-tool" id="tensionTool"></div>
        <div class="pick-tool" id="pickTool"></div>
      </div>
    </div>
    <div class="lock-controls">
      <div class="tension-control">
        <button class="tension-btn" id="tensionBtn">üîÑ</button>
      </div>
      <button class="control-btn left">‚¨ÖÔ∏è</button>
      <button class="control-btn up">‚¨ÜÔ∏è</button>
      <button class="control-btn right">‚û°Ô∏è</button>
    </div>
    <div class="controls">
      <button onclick="resetPins()">Sƒ±fƒ±rla</button>
    </div>
  </div>
  <div id="openBanner">‚ú® Kƒ∞Lƒ∞T A√áILDI! ‚ú®</div>
  <!-- Ses Efektleri -->
  <audio id="clickSound" preload="auto">
    <source src="[https://www.soundjay.com/mechanical/sounds/lock-mechanism-1.mp3"](https://www.soundjay.com/mechanical/sounds/lock-mechanism-1.mp3") type="audio/mpeg">
  </audio>
  <audio id="dropSound" preload="auto">
    <source src="[https://www.soundjay.com/mechanical/sounds/pin-drop-1.mp3"](https://www.soundjay.com/mechanical/sounds/pin-drop-1.mp3") type="audio/mpeg">
  </audio>
  <audio id="unlockSound" preload="auto">
    <source src="[https://www.soundjay.com/mechanical/sounds/door-unlock-1.mp3"](https://www.soundjay.com/mechanical/sounds/door-unlock-1.mp3") type="audio/mpeg">
  </audio>
  <!-- Lightbox -->
  <div class="lightbox-container" id="lightbox">
    <div class="lightbox-content">
      <img src="" alt="Kilit G√∂r√ºnt√ºs√º" class="lightbox-image" id="lightboxImage">
      <div class="lightbox-nav">
        <button class="nav-button" id="prevButton">‚Üê</button>
        <button class="nav-button" id="nextButton">‚Üí</button>
      </div>
    </div>
  </div>
  <!-- Pop-up G√∂r√ºnt√ºler -->
  <div class="popup-images" id="popupImages">
    <img src="[https://images.unsplash.com/photo-1517420879524-86d64ac2f339?w=500"](https://images.unsplash.com/photo-1517420879524-86d64ac2f339?w=500") alt="Kilit 1" class="popup-image" data-index="0">
    <img src="[https://images.unsplash.com/photo-1503792501406-2c40da09e1e2?w=500"](https://images.unsplash.com/photo-1503792501406-2c40da09e1e2?w=500") alt="Kilit 2" class="popup-image" data-index="1">
  </div>
<script>
/* === Ayarlar ve Sabitler === */
const pinCount = 5;
const pinH = 180;
const baseline = 10;
const step = 5;
const tol = 2;
const hold = 20000;
const altHeights = [45, 35, 50, 40, 30];
const padTop = parseInt(getComputedStyle(document.getElementById("lock")).paddingTop);
const shearPin = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--shear-y')) - padTop;
const target = altHeights.map(h => Math.floor(pinH * 0.6) - h);

/* === Dinamik === */
const pos = Array(pinCount).fill(baseline);
const timers = Array(pinCount).fill(null);
const expire = Array(pinCount).fill(null);
const locked = Array(pinCount).fill(false);
const lastClickTime = Array(pinCount).fill(0);
const overflowCounter = Array(pinCount).fill(0);
const OVERFLOW_LIMIT = 3;
let opened = false;
let currentPin = 0;
let inactivityTimer = null;
const INACTIVITY_TIMEOUT = 2000;

const st = document.getElementById("status");
const bn = document.getElementById("openBanner");
const clickSound = document.getElementById("clickSound");
const tensionBtn = document.getElementById("tensionBtn");
const pickTool = document.getElementById("pickTool");
const tensionTool = document.getElementById("tensionTool");

const dot = i => document.getElementById(`dot${i}`);
const alt = i => document.getElementById(`a${i}`);
const drv = i => document.getElementById(`d${i}`);
const pin = i => document.getElementById(`pin${i}`);

/* === Pin Pozisyonlarƒ± === */
const pinPositions = [];
function updatePinPositions() {
  for(let i=0; i<pinCount; i++) {
    const pinElement = document.getElementById(`pin${i}`);
    const rect = pinElement.getBoundingClientRect();
    const lockRect = document.querySelector('.lock').getBoundingClientRect();
    pinPositions[i] = {
      x: rect.left - lockRect.left + rect.width / 2,
      y: rect.bottom - lockRect.bottom
    };
  }
}
updatePinPositions();
window.addEventListener('resize', updatePinPositions);

/* === Pick Aleti === */
function movePick(pinIndex) {
  updatePinPositions();
  const position = pinPositions[pinIndex];
  if(position) {
    pickTool.style.transform = `rotate(-10deg)`;
  }
}
function animatePick() {
  pickTool.classList.add('picking');
  setTimeout(() => {
    pickTool.classList.remove('picking');
  }, 150);
}
function draw(i) {
  alt(i).style.bottom = pos[i] + "px";
  drv(i).style.bottom = (pos[i] + altHeights[i]) + "px";
}

/* === Ba≈ülat === */
for(let i=0; i<pinCount; i++) {
  alt(i).style.height = altHeights[i] + "px";
  draw(i);
}
updateActivePin();
addEvents();
startTick();
startInactivityCheck();

/* === Ses Efektleri === */
function playSound(soundId) {
  const sound = document.getElementById(soundId);
  const playPromise = sound.play();
  if (playPromise !== undefined) {
    playPromise
      .then(() => {
        if(!sound.paused) {
          sound.currentTime = 0;
        }
      })
      .catch(error => {
        if (error.name === "NotAllowedError") {
          document.addEventListener('click', function initAudio() {
            sound.play().then(() => {
              document.removeEventListener('click', initAudio);
            });
          });
        }
      });
  }
}

/* === Mekanik === */
function move(i) {
  if(opened) return;
  pos[i] += step;
  draw(i);
  lastClickTime[i] = Date.now();
  const pinPosition = pos[i] + altHeights[i];
  const targetPosition = pinH - shearPin;
  const diff = Math.abs(pinPosition - targetPosition);
  if(!locked[i]) {
    if(diff <= tol) {
      lock(i);
    } else if(pos[i] > target[i] + tol) {
      overflowCounter[i]++;
      if(overflowCounter[i] >= OVERFLOW_LIMIT) {
        drop(i);
      }
    }
  } else if(diff > tol) {
    drop(i);
  }
}
function lock(i) {
  locked[i] = true;
  dot(i).classList.add("ok");
  playSound('clickSound');
  expire[i] = Date.now() + hold;
  timers[i] = setTimeout(() => drop(i), hold);
  if(locked.every(v => v)) {
    tensionBtn.disabled = false;
  }
}
function drop(i) {
  if(opened) return;
  if(timers[i]) {
    clearTimeout(timers[i]);
    timers[i] = null;
  }
  locked[i] = false;
  expire[i] = null;
  pos[i] = baseline;
  overflowCounter[i] = 0;
  draw(i);
  dot(i).classList.remove("ok");
  dot(i).textContent = "";
  playSound('dropSound');
  tensionBtn.disabled = true;
}
function freezeAll() {
  for(let i=0; i<pinCount; i++) {
    if(timers[i]) {
      clearTimeout(timers[i]);
      timers[i] = null;
    }
    dot(i).textContent = "";
  }
  document.querySelector('.lock').style.boxShadow = `
    inset 0 0 30px rgba(0,255,157,0.2),
    0 10px 20px rgba(0,0,0,0.2)
  `;
  tensionTool.classList.add('turning');
  playSound('unlockSound');
  togglePopupImages(true);
  setTimeout(() => {
    showLightbox(0);
  }, 500);
}
function updateActivePin() {
  for(let i=0; i<pinCount; i++) {
    pin(i).classList.remove('active-pin');
  }
  pin(currentPin).classList.add('active-pin');
}
function startTick() {
  setInterval(() => {
    if(opened) return;
    const now = Date.now();
    for(let i=0; i<pinCount; i++) {
      if(locked[i] && expire[i]) {
        let s = Math.ceil((expire[i]-now)/1000);
        dot(i).textContent = s<=0 ? "" : s;
        if(s <= 5 && s > 0) {
          dot(i).classList.add('warning');
        } else {
          dot(i).classList.remove('warning');
        }
      } else {
        dot(i).textContent = "";
        dot(i).classList.remove('warning');
      }
    }
  }, 1000);
}
function resetPins() {
  if(inactivityTimer) clearInterval(inactivityTimer);
  for(let i=0; i<pinCount; i++) {
    if(timers[i]) clearTimeout(timers[i]);
    timers[i] = null;
    locked[i] = false;
    expire[i] = null;
    pos[i] = baseline;
    lastClickTime[i] = 0;
    overflowCounter[i] = 0;
    draw(i);
    dot(i).classList.remove("ok");
    dot(i).textContent = "";
    pin(i).classList.remove('active-pin');
  }
  opened = false;
  currentPin = 0;
  updateActivePin();
  movePick(currentPin);
  st && (st.style.display = "block");
  st && (st.textContent = "üìå Pimleri hizalayarak kilidi a√ßmayƒ± dene");
  st && (st.style.color = 'rgba(255,255,255,0.9)');
  bn.style.display = "none";
  tensionBtn.disabled = true;
  tensionTool.classList.remove('turning');
  document.querySelector('.lock').style.background = 'linear-gradient(145deg, var(--lock-bg), #a67a45)';
  document.querySelector('.lock-body').style.background = 'linear-gradient(to bottom, var(--lock-bg), #8b5e2e)';
  document.querySelector('.lock').style.boxShadow = `
    inset 0 0 30px rgba(0,0,0,0.3),
    0 10px 20px rgba(0,0,0,0.2)
  `;
  startInactivityCheck();
  togglePopupImages(false);
}
function addEvents() {
  const leftBtn = document.querySelector('.control-btn.left');
  const rightBtn = document.querySelector('.control-btn.right');
  const upBtn = document.querySelector('.control-btn.up');
  leftBtn.onclick = () => {
    currentPin = (currentPin - 1 + pinCount) % pinCount;
    updateActivePin();
    movePick(currentPin);
  };
  rightBtn.onclick = () => {
    currentPin = (currentPin + 1) % pinCount;
    updateActivePin();
    movePick(currentPin);
  };
  upBtn.onclick = () => {
    move(currentPin);
    animatePick();
  };
  tensionBtn.onclick = () => {
    if(locked.every(v => v) && !opened) {
      opened = true;
      freezeAll();
      document.querySelector('.lock').style.background = 'linear-gradient(145deg, #d4a365, #b68355)';
      document.querySelector('.lock-body').style.background = 'linear-gradient(to bottom, #d4a365, #9b6e3e)';
      tensionBtn.disabled = true;
    }
  };
  document.addEventListener('keydown', (e) => {
    if(opened) return;
    switch(e.key) {
      case 'ArrowLeft': leftBtn.click(); break;
      case 'ArrowRight': rightBtn.click(); break;
      case 'ArrowUp':
      case ' ': upBtn.click(); break;
      case 'Enter':
        if(!tensionBtn.disabled) tensionBtn.click();
        break;
    }
  });
  movePick(currentPin);
}
function checkInactivity() {
  const now = Date.now();
  for(let i=0; i<pinCount; i++) {
    if(!locked[i] && pos[i] > baseline) {
      if(now - lastClickTime[i] >= INACTIVITY_TIMEOUT) {
        drop(i);
      }
    }
  }
}
function startInactivityCheck() {
  if(inactivityTimer) clearInterval(inactivityTimer);
  inactivityTimer = setInterval(checkInactivity, 500);
}

/* === Lightbox ve G√∂r√ºnt√º === */
const images = [
  "[https://images.unsplash.com/photo-1517420879524-86d64ac2f339?w=1200",](https://images.unsplash.com/photo-1517420879524-86d64ac2f339?w=1200",)
  "[https://images.unsplash.com/photo-1503792501406-2c40da09e1e2?w=1200"](https://images.unsplash.com/photo-1503792501406-2c40da09e1e2?w=1200")
];
let currentImageIndex = 0;
const lightbox = document.getElementById('lightbox');
const lightboxImage = document.getElementById('lightboxImage');
const popupImages = document.getElementById('popupImages');
const prevButton = document.getElementById('prevButton');
const nextButton = document.getElementById('nextButton');
function togglePopupImages(show) {
  popupImages.style.display = show ? 'flex' : 'none';
}
function showLightbox(index) {
  currentImageIndex = index;
  lightboxImage.src = images[currentImageIndex];
  lightbox.style.display = 'flex';
  popupImages.style.display = 'none';
}
function hideLightbox() {
  lightbox.style.display = 'none';
  if(opened) {
    popupImages.style.display = 'flex';
  }
}
function showPrevImage() {
  currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
  lightboxImage.src = images[currentImageIndex];
}
function showNextImage() {
  currentImageIndex = (currentImageIndex + 1) % images.length;
  lightboxImage.src = images[currentImageIndex];
}
popupImages.querySelectorAll('.popup-image').forEach(img => {
  img.addEventListener('click', () => {
    showLightbox(parseInt(img.dataset.index));
  });
});
lightbox.addEventListener('click', (e) => {
  if (e.target === lightbox) {
    hideLightbox();
  }
});
prevButton.addEventListener('click', (e) => {
  e.stopPropagation();
  showPrevImage();
});
nextButton.addEventListener('click', (e) => {
  e.stopPropagation();
  showNextImage();
});
document.addEventListener('keydown', (e) => {
  if (lightbox.style.display === 'flex') {
    if (e.key === 'ArrowLeft') {
      showPrevImage();
    } else if (e.key === 'ArrowRight') {
      showNextImage();
    } else if (e.key === 'Escape') {
      hideLightbox();
    }
  }
});
</script>
</body>
</html>
