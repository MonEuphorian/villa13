<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Modern Kilit Simülasyonu</title>
  <style>
    :root {
      --pin-w: 45px;
      --pin-h: 180px;
      --shear-y: 108px;
      --main-bg: #1a1a2e;
      --lock-bg: #c49355;
      --pin-color: #3f3f5f;
      --pin-border: #2a2a2a;
      --key-pin: #ff4040;
      --driver-pin: #2176ff;
      --spring-color: #666;
      --success-color: #00ff9d;
      --error-color: #ff4757;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      user-select: none;
    }

    body {
      background: var(--main-bg);
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
    }

    /* Mobilde yatay kaydırma ve zoom engelleme */
    .game-container {
      touch-action: pan-y;
      overscroll-behavior: contain;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    /* Butonlarda tarayıcı varsayılan dokunma eylemlerini devre dışı bırak */
    .control-btn,
    .tension-btn {
      touch-action: none;
      -ms-touch-action: none;
    }

    .indicators {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      justify-content: center;
      align-items: center;
    }

    .dot {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #ff4757;
      box-shadow: 0 0 10px rgba(255,71,87,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 700;
      color: #000;
      transition: all 0.3s ease;
    }

    .dot.ok { background: var(--success-color); box-shadow: 0 0 15px rgba(0,255,157,0.3); }
    .dot.warning { color: #ff0000; }

    .lock {
      position: relative;
      display: flex;
      gap: 10px;
      background: linear-gradient(145deg, var(--lock-bg), #a67a45);
      padding: 40px 30px;
      border-radius: 12px;
      box-shadow: inset 0 0 30px rgba(0,0,0,0.3), 0 10px 20px rgba(0,0,0,0.2);
      transform: rotateX(12deg);
      transform-style: preserve-3d;
      perspective: 1000px;
    }

    .pin {
      width: var(--pin-w);
      height: var(--pin-h);
      background: linear-gradient(to right, #333, #444, #333);
      border: 2px solid var(--pin-border);
      border-radius: 8px;
      overflow: hidden;
      position: relative;
      transition: transform 0.2s ease;
      cursor: pointer;
      box-shadow: inset 0 0 10px rgba(0,0,0,0.3), 0 2px 5px rgba(0,0,0,0.2);
    }

    .pin:hover { transform: translateY(-2px); }
    .pin:active { transform: translateY(0); }

    .spring {
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 40px;
      background: repeating-linear-gradient(0deg, var(--spring-color), var(--spring-color) 2px, transparent 2px, transparent 6px);
      opacity: 0.7;
    }

    .drv { position: absolute; left: 0; width: 100%; height: 30px; background: var(--driver-pin); border-top:2px solid rgba(0,0,0,0.2); border-bottom:2px solid rgba(0,0,0,0.2); transition: all 0.15s ease; box-shadow: inset 0 2px 3px rgba(255,255,255,0.2), inset 0 -2px 3px rgba(0,0,0,0.2); }
    .alt { position: absolute; left: 0; width: 100%; background: var(--key-pin); border-top:2px solid rgba(0,0,0,0.2); border-bottom:2px solid rgba(0,0,0,0.2); transition: all 0.15s ease; box-shadow: inset 0 2px 3px rgba(255,255,255,0.2), inset 0 -2px 3px rgba(0,0,0,0.2); }

    #a0 { height: 45px; }
    #a1 { height: 35px; }
    #a2 { height: 50px; }
    #a3 { height: 40px; }
    #a4 { height: 30px; }

    .lock::before {
      content: "";
      position: absolute;
      left: -15px;
      top: 50%;
      width: 20px;
      height: 50px;
      background: linear-gradient(to left, var(--lock-bg), #8b5e2e);
      transform: translateY(-50%);
      border-radius: 5px 0 0 5px;
      box-shadow: inset 2px 0 5px rgba(0,0,0,0.2);
      z-index: 1;
    }

    .lock-body {
      position: absolute;
      bottom: -20px;
      left: -10px;
      right: -10px;
      height: 40px;
      background: linear-gradient(to bottom, var(--lock-bg), #8b5e2e);
      border-radius: 0 0 12px 12px;
      box-shadow: inset 0 2px 5px rgba(255,255,255,0.2), 0 2px 5px rgba(0,0,0,0.2);
    }

    .keyhole {
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 30px;
      background: #222;
      border-radius: 4px;
      box-shadow: inset 0 0 5px rgba(0,0,0,0.8);
    }

    .lock-tools {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 10;
    }

    .pick-tool {
      position: absolute;
      width: 160px;
      height: 3px;
      background: #666;
      bottom: 50%;
      left: -190px;
      transform-origin: right center;
      transform: rotate(0deg);
      transition: transform 0.15s ease;
    }

    .pick-tool.picking {
      animation: pickMove 0.15s ease-in-out;
    }

    @keyframes pickMove {
      0%, 100% { transform: rotate(0deg) translateY(0); }
      50% { transform: rotate(0deg) translateY(2px); }
    }

    .tension-tool {
      position: absolute;
      width: 140px;
      height: 3px;
      background: #666;
      bottom: calc(50% - 10px);
      left: -175px;
      transform-origin: right center;
      transform: rotate(-65deg);
      transition: transform 0.5s ease;
    }

    .tension-tool.turning { transform: rotate(-110deg); }

    .lock::after {
      content: "";
      position: absolute;
      right: -12px;
      top: 50%;
      width: 15px;
      height: 35px;
      background: linear-gradient(to right, var(--lock-bg), #8b5e2e);
      transform: translateY(-50%);
      border-radius: 0 5px 5px 0;
      box-shadow: inset -2px 0 5px rgba(0,0,0,0.2);
    }

    .lock-controls {
      position: relative;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
      width: 180px;
    }

    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      margin-top: 20px;
    }

    .control-btn {
      width: 50px;
      height: 50px;
      border: none;
      border-radius: 10px;
      background: #2a2a4e;
      color: #fff;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .control-btn:hover { background: #3a3a5e; transform: translateY(-2px); }
    .control-btn:active { transform: translateY(0); }
    .control-btn.left { grid-column: 1; grid-row: 1; }
    .control-btn.up   { grid-column: 2; }
    .control-btn.right{ grid-column: 3; grid-row: 1; }

    .tension-btn {
      width: 50px;
      height: 50px;
      border: none;
      border-radius: 50%;
      background: #ff4040;
      color: #fff;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .tension-btn:hover   { background: #ff5555; transform: scale(1.1); }
    .tension-btn:active  { transform: scale(1); }
    .tension-btn:disabled{ background: #666; cursor: not-allowed; transform: scale(1); }

    .active-pin { border: 2px solid var(--success-color) !important; box-shadow: 0 0 15px rgba(0,255,157,0.3) !important; }

    #status { font-size: 1.1em; color: rgba(255,255,255,0.9); text-align: center; }
    #openBanner { font-size: 24px; font-weight: 700; color: var(--success-color); text-shadow: 0 0 10px rgba(0,255,157,0.3); display: none; }

    @media (max-width: 600px) {
      .game-title { font-size: 2em; }
      .lock { padding: 30px 20px; }
      :root { --pin-w: 40px; --pin-h: 120px; }
      .dot { width: 28px; height: 28px; font-size: 14px; }
    }
  
    /* Lightbox Stili */
    .lightbox-container { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
    .lightbox-content { position: relative; max-width: 90%; max-height: 90%; }
    .lightbox-image { max-width: 100%; max-height: 90vh; object-fit: contain; cursor: pointer; }
    .lightbox-nav { position: absolute; top: 50%; transform: translateY(-50%); width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; }
    .nav-button { background: rgba(255,255,255,0.2); color: white; border: none; padding: 15px 20px; cursor: pointer; border-radius: 5px; font-size: 24px; transition: background 0.3s; }
    .nav-button:hover { background: rgba(255,255,255,0.3); }
    .popup-images { display: none; position: fixed; bottom: 20px; right: 20px; gap: 10px; z-index: 999; }
    .popup-image { width: 150px; height: 100px; object-fit: cover; cursor: pointer; border: 2px solid white; border-radius: 5px; transition: transform 0.3s; }
    .popup-image:hover { transform: scale(1.1); }
  </style>
</head>
<body>
  <div class="background"></div>
  
  <div class="game-container">
    <div class="indicators">
      <div class="dot" id="dot0"></div>
      <div class="dot" id="dot1"></div>
      <div class="dot" id="dot2"></div>
      <div class="dot" id="dot3"></div>
      <div class="dot" id="dot4"></div>
    </div>

    <div class="lock" id="lock">
      <div class="pin" id="pin0">
        <div class="spring"></div>
        <div class="alt" id="a0"></div>
        <div class="drv" id="d0"></div>
      </div>
      <div class="pin" id="pin1">
        <div class="spring"></div>
        <div class="alt" id="a1"></div>
        <div class="drv" id="d1"></div>
      </div>
      <div class="pin" id="pin2">
        <div class="spring"></div>
        <div class="alt" id="a2"></div>
        <div class="drv" id="d2"></div>
      </div>
      <div class="pin" id="pin3">
        <div class="spring"></div>
        <div class="alt" id="a3"></div>
        <div class="drv" id="d3"></div>
      </div>
      <div class="pin" id="pin4">
        <div class="spring"></div>
        <div class="alt" id="a4"></div>
        <div class="drv" id="d4"></div>
      </div>
      <div class="lock-body">
        <div class="keyhole"></div>
      </div>
      <div class="lock-tools">
        <div class="tension-tool" id="tensionTool"></div>
        <div class="pick-tool" id="pickTool"></div>
      </div>
    </div>

    <div class="lock-controls">
      <div class="tension-control">
        <button class="tension-btn" id="tensionBtn">🔄</button>
      </div>
      <button class="control-btn left">⬅️</button>
      <button class="control-btn up">⬆️</button>
      <button class="control-btn right">➡️</button>
    </div>

    <div class="controls">
      <button onclick="resetPins()">Sıfırla</button>
    </div>
  </div>
  
  <div id="openBanner">✨ KİLİT AÇILDI! ✨</div>

  <!-- Ses Efektleri -->
  <audio id="clickSound" preload="auto"><source src="https://www.soundjay.com/mechanical/sounds/lock-mechanism-1.mp3" type="audio/mpeg"></audio>
  <audio id="dropSound" preload="auto"><source src="https://www.soundjay.com/mechanical/sounds/pin-drop-1.mp3" type="audio/mpeg"></audio>
  <audio id="unlockSound" preload="auto"><source src="https://www.soundjay.com/mechanical/sounds/door-unlock-1.mp3" type="audio/mpeg"></audio>

  <!-- Lightbox -->
  <div class="lightbox-container" id="lightbox">
    <div class="lightbox-content">
      <img src="" alt="Kilit Görüntüsü" class="lightbox-image" id="lightboxImage">
      <div class="lightbox-nav">
        <button class="nav-button" id="prevButton">←</button>
        <button class="nav-button" id="nextButton">→</button>
      </div>
    </div>
  </div>

  <!-- Pop-up Görüntüler -->
  <div class="popup-images" id="popupImages">
    <img src="https://images.unsplash.com/photo-1517420879524-86d64ac2f339?w=500" alt="Kilit 1" class="popup-image" data-index="0">
    <img src="https://images.unsplash.com/photo-1503792501406-2c40da09e1e2?w=500" alt="Kilit 2" class="popup-image" data-index="1">
  </div>

<script>
  /* === Ayarlar === */
  const pinCount = 5;
  const pinH = 180;
  const baseline = 10;
  const step = 5;
  const tol = 2;
  const hold = 20000;
  const altHeights = [45, 35, 50, 40, 30];
  const padTop = parseInt(getComputedStyle(document.getElementById("lock")).paddingTop);
  const shearPin = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--shear-y')) - padTop;
  const target = altHeights.map(h => Math.floor(pinH * 0.6) - h);
  const pos = Array(pinCount).fill(baseline);
  const timers = Array(pinCount).fill(null);
  const expire = Array(pinCount).fill(null);
  const locked = Array(pinCount).fill(false);
  const lastClickTime = Array(pinCount).fill(0);
  const overflowCounter = Array(pinCount).fill(0);
  const OVERFLOW_LIMIT = 3;
  let opened = false;
  let currentPin = 0;
  let inactivityTimer = null;
  const INACTIVITY_TIMEOUT = 2000;
  const st = document.getElementById("status");
  const bn = document.getElementById("openBanner");
  const clickSound = document.getElementById("clickSound");
  const tensionBtn = document.getElementById("tensionBtn");
  const pickTool = document.getElementById("pickTool");
  const tensionTool = document.getElementById("tensionTool");
  const pinElem = i => document.getElementById(`pin${i}`);
  const altElem = i => document.getElementById(`a${i}`);
  const drvElem = i => document.getElementById(`d${i}`);

  // Pin pozisyonlarını hesapla
  const pinPositions = [];
  for (let i = 0; i < pinCount; i++) {
    const rect = pinElem(i).getBoundingClientRect();
    const lockRect = document.querySelector('.lock').getBoundingClientRect();
    pinPositions[i] = { x: rect.left - lockRect.left + rect.width/2, y: rect.bottom - lockRect.bottom };
  }

  function movePick(pinIndex) {
    const position = pinPositions[pinIndex];
    if (position) pickTool.style.transform = `rotate(-10deg)`;
  }

  function animatePick() {
    pickTool.classList.add('picking');
    setTimeout(() => pickTool.classList.remove('picking'), 150);
  }

  function draw(i) {
    altElem(i).style.bottom = pos[i] + "px";
    drvElem(i).style.bottom = (pos[i] + altHeights[i]) + "px";
  }

  for (let i = 0; i < pinCount; i++) {
    altElem(i).style.height = altHeights[i] + "px";
    draw(i);
  }
  updateActivePin();
  addEvents();
  startTick();
  startInactivityCheck();

  function playSound(id) {
    const sound = document.getElementById(id);
    const playPromise = sound.play();
    if (playPromise !== undefined) {
      playPromise.catch(err => {
        if (err.name === 'NotAllowedError') {
          document.addEventListener('click', function initAudio() {
            sound.play().then(() => document.removeEventListener('click', initAudio));
          });
        }
      });
    }
  }

  function move(i) {
    if (opened) return;
    pos[i] += step;
    draw(i);
    lastClickTime[i] = Date.now();
    const pinPosition = pos[i] + altHeights[i];
    const targetPos = pinH - shearPin;
    const diff = Math.abs(pinPosition - targetPos);
    if (!locked[i]) {
      if (diff <= tol) lockPin(i);
      else if (pos[i] > target[i] + tol && ++overflowCounter[i] >= OVERFLOW_LIMIT) drop(i);
    } else if (diff > tol) drop(i);
  }

  function lockPin(i) {
    locked[i] = true;
    document.getElementById(`dot${i}`).classList.add('ok');
    playSound('clickSound');
    expire[i] = Date.now() + hold;
    timers[i] = setTimeout(() => drop(i), hold);
    if (locked.every(v => v)) tensionBtn.disabled = false;
  }

  function drop(i) {
    if (opened) return;
    clearTimeout(timers[i]);
    locked[i] = false;
    pos[i] = baseline;
    overflowCounter[i] = 0;
    draw(i);
    document.getElementById(`dot${i}`).classList.remove('ok');
    document.getElementById(`dot${i}`).textContent = '';
    playSound('dropSound');
    tensionBtn.disabled = true;
  }

  function freezeAll() {
    timers.forEach((t,i) => t && clearTimeout(t));
    document.querySelectorAll('.dot').forEach(d => d.textContent = '');
    document.querySelector('.lock').style.boxShadow = 'inset 0 0 30px rgba(0,255,157,0.2),0 10px 20px rgba(0,0,0,0.2)';
    tensionTool.classList.add('turning');
    playSound('unlockSound');
    togglePopupImages(true);
    setTimeout(() => showLightbox(0), 500);
  }

  function updateActivePin() {
    document.querySelectorAll('.pin').forEach((el, i) => el.classList.toggle('active-pin', i===currentPin));
  }

  function startTick() {
    setInterval(() => {
      if (opened) return;
      const now = Date.now();
      expire.forEach((exp,i) => {
        const el = document.getElementById(`dot${i}`);
        if (locked[i] && exp) {
          const s = Math.ceil((exp-now)/1000);
          el.textContent = s>0 ? s : '';
          el.classList.toggle('warning', s>0 && s<=5);
        }
      });
    },1000);
  }

  function resetPins() {
    clearInterval(inactivityTimer);
    for (let i=0; i<pinCount; i++) { clearTimeout(timers[i]); locked[i]=false; pos[i]=baseline; overflowCounter[i]=0; draw(i); document.getElementById(`dot${i}`).classList.remove('ok'); document.getElementById(`dot${i}`).textContent=''; }
    opened=false; currentPin=0; updateActivePin(); movePick(0);
    document.getElementById('status').textContent='📌 Pimleri hizalayarak kilidi açmayı dene';
    tensionBtn.disabled=true;
    document.querySelector('.lock').style.background='linear-gradient(145deg,var(--lock-bg),#a67a45)';
    document.querySelector('.lock-body').style.background='linear-gradient(to bottom,var(--lock-bg),#8b5e2e)';
    document.getElementById('openBanner').style.display='none';
    startInactivityCheck(); togglePopupImages(false);
  }

  function addEvents() {
    document.querySelector('.control-btn.left').onclick = () => { currentPin = (currentPin-1+pinCount)%pinCount; updateActivePin(); movePick(currentPin); };
    document.querySelector('.control-btn.right').onclick = () => { currentPin = (currentPin+1)%pinCount; updateActivePin(); movePick(currentPin); };
    document.querySelector('.control-btn.up').onclick    = () => { move(currentPin); animatePick(); };
    tensionBtn.onclick = () => { if (locked.every(v=>v) && !opened) { opened=true; freezeAll(); document.querySelector('.lock').style.background='linear-gradient(145deg,#d4a365,#b68355)'; document.querySelector('.lock-body').style.background='linear-gradient(to bottom,#d4a365,#9b6e3e)'; tensionBtn.disabled=true; }};
    document.addEventListener('keydown', e => {
      if (opened) return;
      if (e.key==='ArrowLeft') document.querySelector('.control-btn.left').click();
      if (e.key==='ArrowRight') document.querySelector('.control-btn.right').click();
      if (e.key==='ArrowUp' || e.key===' ') document.querySelector('.control-btn.up').click();
      if (e.key==='Enter' && !tensionBtn.disabled) tensionBtn.click();
    });
    movePick(currentPin);
  }

  function checkInactivity() {
    const now=Date.now();
    pos.forEach((p,i) => {
      if (!locked[i] && p>baseline && now-lastClickTime[i]>=INACTIVITY_TIMEOUT) drop(i);
    });
  }

  function startInactivityCheck() {
    clearInterval(inactivityTimer);
    inactivityTimer = setInterval(checkInactivity,500);
  }

  // --- Lightbox and popup logic ---
  const images=[
    'https://images.unsplash.com/photo-1517420879524-86d64ac2f339?w=1200',
    'https://images.unsplash.com/photo-1503792501406-2c40da09e1e2?w=1200'
  ]; let currentImageIndex=0;
  const lightbox=document.getElementById('lightbox');
  const lightboxImage=document.getElementById('lightboxImage');
  const popupImages=document.getElementById('popupImages');
  const prevButton=document.getElementById('prevButton');
  const nextButton=document.getElementById('nextButton');

  function togglePopupImages(show) { popupImages.style.display=show?'flex':'none'; }
  function showLightbox(idx) { currentImageIndex=idx; lightboxImage.src=images[idx]; lightbox.style.display='flex'; popupImages.style.display='none'; }
  function hideLightbox() { lightbox.style.display='none'; if(opened) popupImages.style.display='flex'; }
  function showPrevImage() { showLightbox((currentImageIndex-1+images.length)%images.length); }
  function showNextImage() { showLightbox((currentImageIndex+1)%images.length); }
  popupImages.querySelectorAll('.popup-image').forEach(img=> img.addEventListener('click',()=> showLightbox(+img.dataset.index)));
  lightbox.addEventListener('click',e=> e.target===lightbox && hideLightbox());
  prevButton.addEventListener('click',e=>{ e.stopPropagation(); showPrevImage(); });
  nextButton.addEventListener('click',e=>{ e.stopPropagation(); showNextImage(); });
  document.addEventListener('keydown', e=> {
    if (lightbox.style.display==='flex') {
      if (e.key==='ArrowLeft') showPrevImage();
      if (e.key==='ArrowRight') showNextImage();
      if (e.key==='Escape') hideLightbox();
    }
  });

  // === Dokunma düzeltmeleri: çift dokunma zoom ve yatay kaydırmayı engelle ===
  let lastTouch=0;
  document.addEventListener('touchend', e => {
    const now=Date.now();
    if (now-lastTouch<=300) e.preventDefault();
    lastTouch=now;
  }, { passive:false });

  document.querySelector('.game-container').addEventListener('touchmove', e => e.preventDefault(), { passive:false });
</script>
</body>
</html>
